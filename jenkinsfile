pipeline {
  // Run the pipeline on your custom agent
  agent { label 'jenkins-agent' }

  environment {
    APP_NAME = 'devsecops2-challenge'
    REGISTRY = '10.25.157.175:32003'
    IMAGE_NAME = "${REGISTRY}/docker-hosted/${APP_NAME}"
  }

  stages {
    stage('Checkout') {
      steps {
        // Pull from your GitHub repoâ€™s main branch using git-https credentials
        git(
          url: 'https://github.com/pranesh6hpe/devsecops2-challenge.git',
          branch: 'main',
          credentialsId: 'git-https'
        )
      }
    }

    stage('Debug JDK') {
      steps {
        // Verify the agent is using Java 21
        sh 'java -version; javac -version'
      }
    }

    stage('Build & Test') {
      steps {
        // Build with Maven 3.9.7+ on the host
        sh 'mvn clean verify -DskipITs'
      }
